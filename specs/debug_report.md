# Project Status & Debugging Report - Dec 19, 2025

## Current Objective

Deployment of game logic updates to production and stabilization of the local development environment for E2E testing.

## Summary of Recent Changes

1. **Multi-Player Sync Fix**: Fixed a production bug where the Host client was receiving stale state. The API was broadcasting `player_joined` but the new TanStack Query-based frontend was only listening for `room_updated`. All join/start handlers now broadcast the full `room_updated` event.
2. **Production Deployment**:
   - **API**: Deployed to PartyKit (https://rank-everything.lassenordahl.partykit.dev).
   - **Web**: Deployed to Cloudflare Pages (https://rank-everything.pages.dev).
3. **Resilient Smoke Tests**: Updated `apps/web/e2e/smoke.spec.ts` with explicit waits for player count updates and detailed logging to track WebSocket/HTTP synchronization.

---

## üõë The Block: Local Dev "Ghost" TSConfig Error

During local development (`npm run dev`), Vite/esbuild encounters a persistent 500 error when trying to serve the shared validation package.

### Error Message (from Playwright Logs & Browser Console)

```
[plugin:vite:esbuild] failed to resolve "extends":"../../tsconfig.json" in /Users/lassenordahl/dev/rank-everything/packages/validation/tsconfig.json
```

### The Mystery

The file `/Users/lassenordahl/dev/rank-everything/packages/validation/tsconfig.json` **DOES NOT** contain an `extends` property in its current state:

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "outDir": "./dist",
    "declaration": true
  },
  "include": ["src/**/*"]
}
```

### Steps Taken to Resolve (Failed)

1. **Vite Cache Clean**: Deleted `apps/web/node_modules/.vite`.
2. **Root TSConfig**: Created a dummy `tsconfig.json` at the project root to satisfy the "resolve" error, but Vite still reports the same failure relative to the internal validation path.
3. **Internal Extension Search**: Grep yielded no occurrences of `extends` pointing to `../../tsconfig.json` in the active source code, though it appears in the `test-results/` error context files generated by Playwright.

---

## Technical Context for Handover

- **Monorepo Structure**:
  - `apps/web`: Vite + React + TanStack Query.
  - `apps/api`: PartyKit (Serverless WebSockets).
  - `packages/validation`: Shared Zod schemas (local workspace dependency).
- **Local Dev URLs**:
  - Web: http://localhost:5173
  - API (Proxied through Vite): http://localhost:5173/party/... (Targets http://localhost:1999)
- **Production URLs**:
  - Web: https://rank-everything.pages.dev
  - API: https://rank-everything.lassenordahl.partykit.dev

### Current State of Smoke Tests

- **Multi-Player (Production)**: ‚úÖ PASSING (verified after API broadcast fix).
- **Local Dev Smoke Tests**: ‚ùå FAILING due to the 500 compilation error on `@rank-everything/validation`.
